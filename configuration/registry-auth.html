<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Registry Auth - Kobold</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../webhooks/index.html"><strong aria-hidden="true">2.</strong> Webhooks Events</a></li><li class="chapter-item expanded "><a href="../comments/index.html"><strong aria-hidden="true">3.</strong> Comments</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../comments/exact.html"><strong aria-hidden="true">3.1.</strong> Exact Match</a></li><li class="chapter-item expanded "><a href="../comments/semver.html"><strong aria-hidden="true">3.2.</strong> Semantic Versioning</a></li><li class="chapter-item expanded "><a href="../comments/regex.html"><strong aria-hidden="true">3.3.</strong> Regular Expression</a></li></ol></li><li class="chapter-item expanded "><a href="../image-tags/index.html"><strong aria-hidden="true">4.</strong> Image Tags</a></li><li class="chapter-item expanded "><a href="../configuration/index.html"><strong aria-hidden="true">5.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../configuration/endpoints.html"><strong aria-hidden="true">5.1.</strong> Endpoints</a></li><li class="chapter-item expanded "><a href="../configuration/repositories.html"><strong aria-hidden="true">5.2.</strong> Repositories</a></li><li class="chapter-item expanded "><a href="../configuration/subscriptions.html"><strong aria-hidden="true">5.3.</strong> Subscriptions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../configuration/pull-requests.html"><strong aria-hidden="true">5.3.1.</strong> Pull Requests</a></li><li class="chapter-item expanded "><a href="../configuration/scopes.html"><strong aria-hidden="true">5.3.2.</strong> Scopes</a></li><li class="chapter-item expanded "><a href="../configuration/file-associations.html"><strong aria-hidden="true">5.3.3.</strong> File Associations</a></li></ol></li><li class="chapter-item expanded "><a href="../configuration/resolvers.html"><strong aria-hidden="true">5.4.</strong> Resolvers</a></li><li class="chapter-item expanded "><a href="../configuration/registry-auth.html" class="active"><strong aria-hidden="true">5.5.</strong> Registry Auth</a></li></ol></li><li class="chapter-item expanded "><a href="../deployment/index.html"><strong aria-hidden="true">6.</strong> Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/kubernetes.html"><strong aria-hidden="true">6.1.</strong> Kubernetes</a></li><li class="chapter-item expanded "><a href="../deployment/bare-metal.html"><strong aria-hidden="true">6.2.</strong> Bare Metal</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Kobold</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/bluebrown/kobold" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/bluebrown/kobold/edit/main/docs/src/configuration/registry-auth.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="registry-auth"><a class="header" href="#registry-auth">Registry Auth</a></h1>
<p>Depending on the image registry, the push event payload may not contain all
required data. In such cases, kobold will fetch the missing data from the given
registry. Because of this it may need to authenticate against the registry.</p>
<p>The <a href="https://github.com/google/go-containerregistry/tree/main/pkg/authn">authn
package</a> is
used for authentication. You can review their repository to learn more. It will
be either the default or k8s chain.</p>
<h2 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h2>
<p>When running in kubernetes, the registryAuth property can be used to access
image pull secrets. For this the <code>--k8schain</code> switch must be set.
ImagePullSecrets are taken from the service account in the configuration and
from imagePullSecrets listed. Both service account and imagePullSecrets are
looked up in the given namespace.</p>
<pre><code class="language-yaml">registryAuth:
  namespace: ${NAMESPACE}
  serviceAccount: kobold
  imagePullSecrets:
    - name: regcreds
</code></pre>
<p>When enabling the k8schain, you <em>may</em> need to create rbac resources allowing
kobold to lookup services accounts and secrets.</p>
<p>The below rbac resources config will be created if you use the provided
kustomization, to ensure kobold is allowed to lookup service accounts and
secrets in its own namespace.</p>
<pre><code class="language-yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: kobold
automountServiceAccountToken: true
imagePullSecrets: []
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: k8schain
rules:
  - apiGroups: [&quot;&quot;]
    resources: [&quot;serviceaccounts&quot;, &quot;secrets&quot;]
    verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kobold-k8schain
  namespace: default
subjects:
  - kind: ServiceAccount
    name: kobold
    namespace: default
roleRef:
  kind: Role
  name: k8schain
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<p>You can disable the lookup of the service account by using the value <code>no service account</code> as service account name.</p>
<pre><code class="language-yaml">registryAuth:
  serviceAccount: &quot;no service account&quot;
</code></pre>
<p>By doing this, you could remove the resource <code>serviceaccounts</code> from the rbac
role.</p>
<p>If you don't provide a <code>registryAuth</code> key in your config and use the k8s chain,
kobold will default to the values of the environment variables <code>$NAMESPACE</code> and
<code>$SERVICE_ACCOUNT_NAME</code>, if set. Otherwise it will use the <code>default</code> namespace and
<code>no service account</code>. This allows to use the other parts of the k8s chain
without the actual need for rbac.</p>
<h2 id="bare-metal"><a class="header" href="#bare-metal">Bare Metal</a></h2>
<p>If the flag is not used, kobold will attempt to use your local configuration to
authenticate. If you have logged in via docker cli, for example, kobold will be
able to access your private repository.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../configuration/resolvers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../deployment/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../configuration/resolvers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../deployment/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
